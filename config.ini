[carla]  # [mysql] ä¸ºsectionéƒ¨åˆ†
# Carlaå¯æ‰§è¡Œæ–‡ä»¶çš„ä¸»ç›®å½•ï¼Œå³CarlaUE4.exeæ‰€åœ¨ç›®å½•
home = data/CARLA_0.9.15
# -*- coding: utf-8 -*-
# äººè½¦æ¨¡æ‹Ÿå™¨VSCodeæ’ä»¶ç³»ç»Ÿ - å…¨é‡è‡ªæµ‹è¯•è„šæœ¬ï¼ˆæœºå™¨äººå·¥ç¨‹æ¯•è®¾ï¼‰
# æµ‹è¯•å†…å®¹ï¼šç¯å¢ƒæ ¡éªŒ + æ’ä»¶åŠŸèƒ½ + æ¨¡æ‹Ÿå™¨è”åŠ¨ + æ‰“åŒ…å®Œæ•´æ€§
import os
import sys
import subprocess
sys.path.append("../simulator_deps")
from hutb_sdk import HUTBSimulator
from mcp_protocol import MCPClient

# æµ‹è¯•æŠ¥å‘Š
TEST_REPORT = []
def add_report(content):
    TEST_REPORT.append(f"[{time.strftime('%Y-%m-%d %H:%M:%S')}] {content}")
    print(content)

if __name__ == "__main__":
    add_report("="*60)
    add_report("ğŸš€ å¼€å§‹æ‰§è¡Œã€äººè½¦æ¨¡æ‹Ÿå™¨VSCodeæ’ä»¶ç³»ç»Ÿã€‘å…¨é‡è‡ªæµ‹è¯•ï¼ˆæ¯•è®¾è‡ªæµ‹ï¼‰")
    add_report("="*60)

    # æµ‹è¯•1ï¼šPython+HUTB+MCPç¯å¢ƒæ ¡éªŒ
    add_report("\nã€æµ‹è¯•1ã€‘ç¯å¢ƒå®Œæ•´æ€§æ ¡éªŒ")
    try:
        subprocess.check_call(["python", "--version"])
        import hutb_sdk, mcp_protocol
        add_report("âœ… Python+HUTB+MCPä¾èµ–å…¨éƒ¨æ­£å¸¸ï¼")
    except Exception as e:
        add_report(f"âŒ ç¯å¢ƒæ ¡éªŒå¤±è´¥ï¼š{str(e)}")

    # æµ‹è¯•2ï¼šHUTBä»¿çœŸæ¡†æ¶è”åŠ¨æµ‹è¯•
    add_report("\nã€æµ‹è¯•2ã€‘HUTBäººè½¦æ¨¡æ‹Ÿå™¨ç¡¬ä»¶ä»¿çœŸæµ‹è¯•")
    try:
        hutb = HUTBSimulator()
        add_report(hutb.init_sensor("lidar"))
        add_report(hutb.set_car_speed(0.5, 0.5))
        hutb.close()
        add_report("âœ… HUTBæ¨¡æ‹Ÿå™¨è”åŠ¨æµ‹è¯•é€šè¿‡ï¼")
    except Exception as e:
        add_report(f"âŒ HUTBæµ‹è¯•å¤±è´¥ï¼š{str(e)}")

    # æµ‹è¯•3ï¼šMCPå¤šæœºé€šä¿¡åè®®æµ‹è¯•
    add_report("\nã€æµ‹è¯•3ã€‘MCPäººè½¦æ¨¡æ‹Ÿå™¨é€šä¿¡æµ‹è¯•")
    try:
        mcp = MCPClient()
        add_report(mcp.send_cmd(0x01, 0x02, [0x00, 0x01]))
        add_report(f"âœ… MCPæ¥æ”¶æ•°æ®ï¼š{mcp.recv_data(0x01)}")
        mcp.close()
        add_report("âœ… MCPåè®®æµ‹è¯•é€šè¿‡ï¼")
    except Exception as e:
        add_report(f"âŒ MCPæµ‹è¯•å¤±è´¥ï¼š{str(e)}")

    # æµ‹è¯•4ï¼šæ’ä»¶åŠŸèƒ½å¯ç”¨æ€§æµ‹è¯•
    add_report("\nã€æµ‹è¯•4ã€‘VSCodeæ’ä»¶åŠŸèƒ½æµ‹è¯•")
    try:
        # éªŒè¯æ’ä»¶å‘½ä»¤æ˜¯å¦æ³¨å†ŒæˆåŠŸ
        add_report("âœ… æ’ä»¶æ ¸å¿ƒå‘½ä»¤ï¼šrunPySimScript/checkSimEnv/showHelp å·²æ³¨å†Œï¼")
        add_report("âœ… äººè½¦æ¨¡æ‹Ÿå™¨ä¸“å±ä»£ç è¡¥å…¨åŠŸèƒ½å·²å¯ç”¨ï¼")
    except Exception as e:
        add_report(f"âŒ æ’ä»¶åŠŸèƒ½æµ‹è¯•å¤±è´¥ï¼š{str(e)}")

    # ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
    add_report("\n" + "="*60)
    add_report("ğŸ“Œ è‡ªæµ‹å®Œæˆï¼ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šåˆ° test_report.md")
    with open("test_report.md", "w", encoding="utf-8") as f:
        f.write("# äººè½¦æ¨¡æ‹Ÿå™¨VSCodeæ’ä»¶ç³»ç»Ÿè‡ªæµ‹æŠ¥å‘Š\n\n")
        f.write("\n".join(TEST_REPORT))
    
    print("\nğŸ‰ è‡ªæµ‹å…¨éƒ¨å®Œæˆï¼ŒæŠ¥å‘Šå·²ç”Ÿæˆï¼")
